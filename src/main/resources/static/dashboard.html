<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard - Customers</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="/css/style.css" rel="stylesheet" />

    <style>
        /* Optional: sticky header on table */
        thead th {
            position: sticky;
            top: 0;
            background-color: #212529; /* Bootstrap dark table header bg */
            color: #fff;
            z-index: 1;
        }

        /* Smaller font on mobile */
        @media (max-width: 575.98px) {
            table {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar" class="hide" >
    <h4 class="text-white">My Dashboard</h4>
    <hr class="text-white" />
    <ul class="nav flex-column">
        <li><a href="dashboard.html" class="nav-link text-white active"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
        <li><a href="pos.html" class="nav-link text-white"><i class="bi bi-receipt"></i> POS</a></li>
        <li><a href="customer.html" class="nav-link"><i class="bi bi-people"></i> Customer</a></li>
        <li><a href="category.html" class="nav-link "><i class="bi bi-tags"></i> Category</a></li>
        <li><a href="product.html" class="nav-link text-white"><i class="bi bi-box"></i> Product</a></li>
        <li><a href="inventory.html" class="nav-link text-white"><i class="bi bi-archive"></i> Inventory</a></li>
        <li><a href="report.html" class="nav-link text-white"><i class="bi bi-bar-chart"></i> Report</a></li>
        <li><a href="profile.html" class="nav-link text-white"><i class="bi bi-person"></i> Profile</a></li>
        <li><a href="register.html" class="nav-link text-white"><i class="bi bi-person-plus"></i> Register</a></li>
        <li><a href="settings.html" class="nav-link text-white"><i class="bi bi-gear"></i> Settings</a></li>
    </ul>
    <hr class="text-white" />
    <button class="btn btn-danger w-100" id="logoutBtn">Logout</button>
</div>

<!-- Sidebar Overlay -->
<div id="sidebarOverlay"></div>

<!-- Main Content -->
<div id="content" class="container-fluid p-4" >
    <button id="sidebarToggle" class="btn btn-dark mb-3" aria-label="Toggle sidebar">â˜° Menu</button>

    <h3>Welcome, <span id="username">User</span>!</h3>

    <div class="mb-4">
        <label for="token" class="form-label fw-bold">Your JWT Token:</label>
        <textarea id="token" class="form-control" rows="4" readonly></textarea>
    </div>

    <div id="dashboardContent" class="card p-4 shadow">
        <h4 class="mb-4">Customers</h4>

        <div class="row mb-3">
            <div class="col-md-4 col-sm-6">
                <label for="searchId" class="form-label fw-semibold">Search by Customer ID:</label>
                <input
                        type="number"
                        id="searchId"
                        class="form-control"
                        placeholder="Enter Customer ID"
                        aria-label="Search customers by ID"
                />
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-dark">
                <tr>
                    <th scope="col" style="min-width: 60px;">ID</th>
                    <th scope="col" style="min-width: 150px;">Name</th>
                    <th scope="col" style="min-width: 200px;">Email</th>
                    <th scope="col" style="min-width: 130px;">Phone</th>
                    <th scope="col" style="min-width: 250px;">Address</th>
                    <th scope="col" style="min-width: 120px;">Created By</th>
                </tr>
                </thead>
                <tbody id="customerTableBody">
                <tr><td colspan="6" class="text-center py-4">Loading customers...</td></tr>
                </tbody>
            </table>
        </div>

    </div>

    <button class="btn btn-info mt-3" id="refreshBtn">Refresh Dashboard</button>
</div>

<!-- Sidebar and dashboard script -->
<script src="/js/sidebar.js"></script>
<script>
    async function fetchCustomers() {
        try {
            const token = localStorage.getItem('token');
            if (!token) throw new Error('No token found');

            const res = await fetch('/api/customers', {
                headers: { Authorization: `Bearer ${token}` }
            });
            if (!res.ok) throw new Error(`Error fetching customers: ${res.statusText}`);

            return await res.json();
        } catch (error) {
            console.error(error);
            return [];
        }
    }

    function renderCustomers(customers) {
        const tbody = document.getElementById('customerTableBody');
        if (!tbody) return;

        if (customers.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="text-center py-4">No customers found.</td></tr>`;
            return;
        }

        tbody.innerHTML = customers
            .map(cust => `
        <tr>
          <td>${cust.id}</td>
          <td>${cust.name}</td>
          <td>${cust.email}</td>
          <td>${cust.phone}</td>
          <td>${cust.address}</td>
          <td>${cust.createdBy ? cust.createdBy.username : 'N/A'}</td>
        </tr>
      `)
            .join('');
    }

    async function loadCustomers(filterId = null) {
        const allCustomers = await fetchCustomers();
        let filteredCustomers = allCustomers;

        if (filterId) {
            filteredCustomers = allCustomers.filter(c => c.id === filterId);
        }

        renderCustomers(filteredCustomers);
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadCustomers();

        const searchInput = document.getElementById('searchId');
        searchInput.addEventListener('input', () => {
            const val = searchInput.value.trim();
            const id = val ? parseInt(val, 10) : null;
            loadCustomers(id);
        });

        const refreshBtn = document.getElementById('refreshBtn');
        refreshBtn.addEventListener('click', () => loadCustomers());
    });
</script>

</body>
</html>
